# yaml-language-server: $schema=../../artifacts/json-schemas/project.json
name: rust-lib

cache:
  enabled: true
  key:
    defaults: true
    files:
      - "Cargo.toml"
      - "@workspace/Cargo.toml"
      - "@workspace/Cargo.lock"
      - "./src/**/*.rs"

extends:
  - "@workspace/omni/presets/base.omni.yaml"

tasks:
  test: cargo test -p ${PROJECT_NAME}

  bench: cargo bench -p ${PROJECT_NAME}

  profile:
    command: cargo flamegraph --profile=${profile:-bench-with-debug} --bench ${bench:-${PROJECT_NAME}_benchmarks} -p ${PROJECT_NAME} -- --bench --profile-time=${profile_time:-5}

  build:
    command: cargo build --release --package ${PROJECT_NAME}
    dependencies:
      - test
