# yaml-language-server: $schema=../../artifacts/json-schemas/project.json
name: rust-lib

cache:
  enabled: true
  key:
    defaults: true
    files:
      - "Cargo.toml"
      - "@workspace/Cargo.toml"
      - "@workspace/Cargo.lock"
      - "./src/**/*.rs"

extends:
  - "./base.omni.yaml"

tasks:
  test:
    command: cargo test -p ${PROJECT_NAME}
    cache:
      key:
        files:
          append: ["./tests/**/*.rs"]

  bench:
    command: cargo bench -p ${PROJECT_NAME}
    cache:
      key:
        files:
          append: ["./benches/**/*.rs"]

  profile:
    command: cargo flamegraph --profile=${profile:-bench-with-debug} --bench ${bench:-${PROJECT_NAME}_benchmarks} -p ${PROJECT_NAME} -- --bench --profile-time=${profile_time:-5}

meta:
  language: rust
  type: lib
