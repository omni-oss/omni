# yaml-language-server: $schema=../../.artifacts/generator.json
name: crate
display_name: Rust Crate
description: Generate a new rust crate

prompts:
  - type: confirm
    name: use_tracing
    message: Use tracing
    default: true

  - type: select
    name: crate_type
    message: Crate type
    options:
      - name: Library
        value: lib
      - name: Binary
        value: bin

  - type: text
    name: crate_name
    message: Crate name
    validate:
      - condition: "{{ value | length > 0 }}"
        error_message: Crate name must not be empty
      - condition: "{{ value is matching('^[a-zA-Z_]{1}[a-zA-Z0-9_-]*$') }}"
        error_message: >
          Crate name must only contain alphanumeric characters, underscores, and hyphens,
          and must start with a letter

  - type: confirm
    name: add_error_type
    message: Add error type
    default: true

targets:
  root: .
  root_cargo_toml: "@workspace/Cargo.toml"

actions:
  - type: add-many
    base_path: templates
    target: root
    template_files:
      - templates/**
      - "!templates/src/main.rs.tpl"

  - if: "{{ prompts.crate_type == 'bin' }}"
    type: add
    target: root
    template_file: templates/src/main.rs.tpl
    base_path: templates

  - if: "{{ prompts.add_error_type }}"
    type: run-generator
    generator: rust-error
    targets:
      root: ./src
    prompt_values:
      forward: all

  - type: prepend-content
    target: root_cargo_toml
    pattern: "@anchor:new-crate"
    template: '{{ prompts.crate_name }} = { path = "{{ output_path }}" }'
