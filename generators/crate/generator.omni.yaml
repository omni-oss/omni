# yaml-language-server: $schema=../../.artifacts/generator.json
name: crate
display_name: Rust Crate
description: Generate a new rust crate

prompts:
  - type: confirm
    name: use_tracing
    message: Use tracing
    default: true

  - type: select
    name: crate_type
    message: Crate type
    options:
      - name: Library
        value: lib
      - name: Binary
        value: bin

  - type: text
    name: crate_name
    message: Crate name
    validate:
      - condition: "{{ value | length > 0 }}"
        error_message: Crate name must not be empty
      - condition: "{{ value is matching('^[a-zA-Z_]{1}[a-zA-Z0-9_-]*$') }}"
        error_message: Crate name must only contain alphanumeric characters, underscores, and hyphens, and must start with a letter

targets:
  root: .

actions:
  - type: add-inline
    output_path: Cargo.toml
    target: root
    template: |
      [package]
      name = "{{ prompts.crate_name }}"
      version = "0.1.0"
      edition = "2021"

      [dependencies]
      {% if prompts.use_tracing %}
      trace = { workspace = true }
      tracing = { workspace = true }
      tracing-subscriber = { workspace = true }
      {% endif %}

      [features]
      {% if prompts.use_tracing %}
      default = ["enable-tracing"]
      enable-tracing = ["trace/enabled"]
      {% else %}
      default = [""]
      {% endif %}

      [workspace]

      [lib]
      name = "{{ prompts.crate_name }}"
      path = "src/lib.rs"

      {% if prompts.crate_type == "bin" %}
      [[bin]]
      name = "{{ prompts.crate_name }}"
      path = "src/main.rs"
      {% endif %}
