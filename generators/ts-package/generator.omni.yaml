# yaml-language-server: $schema=https://raw.githubusercontent.com/omni-oss/omni/refs/heads/json-schemas/project-latest.json
name: ts-package
display_name: TypeScript Package
description: A TypeScript package generator

prompts:
  - name: package_name
    type: text
    message: What is the name of your package?
    validate:
      - condition: "{{ value | length > 0 }}"
        error_message: Package name must not be empty
      - condition: "{{ value is matching('^[a-zA-Z_]{1}[a-zA-Z0-9_-]*$') }}"
        error_message: >
          Package name must only contain alphanumeric characters, underscores, and hyphens,
          and must start with a letter

  - name: package_type
    type: select
    message: What type of package is this?
    options:
      - name: Library
        value: lib
      - name: Application
        value: app
      - name: Script
        value: script
    default: lib

  - if: "{{ prompts.package_type == 'script' }}"
    name: script_can_be_used_as_lib
    type: confirm
    message: Can this script be used as a library?
    default: false

  - if: "{{ prompts.package_type == 'script' }}"
    name: shebang_executor
    type: select
    message: What shebang should be used for the script?
    options:
      - name: Node.js
        value: "node"
      - name: Bun
        value: "bun"
      - name: Deno
        value: "deno"
    default: "node"

  - name: package_description
    type: text
    message: What is the description of your package?
    default: A TypeScript Package

  - name: unit_test
    type: confirm
    message: Do you want to add unit tests?
    default: true

  - name: integration_test
    type: confirm
    message: Do you want to add integration tests?
    default: true

  - name: package_version
    type: text
    message: What is the version of your package?
    default: 0.0.0-semantically-released

  - name: package_license
    type: text
    message: What is the license of your package?
    default: MIT

  - name: published
    type: confirm
    message: Will the package be published to a registry?
    default: false

  - name: publish_access
    type: select
    message: What is the publish access of your package?
    options:
      - name: Public
        value: public
      - name: Restricted
        value: restricted
    default: public

actions:
  - type: add-many
    base_path: templates
    files:
      - templates/**/*
      - "!templates/src/cli/index.ts.tpl"
      - "!templates/vitest.config.unit.ts.tpl"
      - "!templates/vitest.config.integration.ts.tpl"
      - "!templates/src/__tests__/integration.spec.ts.tpl"
      - "!templates/src/add.spec.ts.tpl"

  - if: "{{ prompts.package_type == 'script' }}"
    type: add-many
    base_path: templates
    files:
      - templates/src/cli/index.ts.tpl

  - if: "{{ prompts.integration_test }}"
    type: add-many
    base_path: templates
    files:
      - templates/vitest.config.integration.ts.tpl
      - templates/src/__tests__/integration.spec.ts.tpl

  - if: "{{ prompts.unit_test }}"
    type: add-many
    base_path: templates
    files:
      - templates/vitest.config.unit.ts.tpl
      - templates/src/add.spec.ts.tpl
