# yaml-language-server: $schema=https://raw.githubusercontent.com/omni-oss/omni/refs/heads/json-schemas/project-latest.json
name: omni_remote_cache_service

extends:
  - "@workspace/omni/presets/rust-service.omni.yaml"
  - "@workspace/omni/presets/rust-multiplatform.omni.yaml"

tasks:
  dev:
    env:
      vars:
        ADDITIONAL_ARGS: >
          -- serve -b in-memory --routes.enable-openapi
  build:
    meta:
      is_publish_task: true

  prod:
    command: >
      ${WORKSPACE_DIR}/target/release/omni_remote_cache_service
      serve
      -b
      local-disk
      --routes.enable-openapi
      --local-disk.root-dir
      ${PROJECT_DIR}/.omni/remote_cache/data

    dependencies:
      - build

    cache:
      enabled: false

  profile:
    dependencies:
      - ^passthrough

dependencies:
  - omni_remote_cache_storage
  - omni_tracing_subscriber
  - omni_path_utils
  - maps
  - sets
